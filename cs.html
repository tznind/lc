<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hexagon Inputs with Titles</title>
<link rel="stylesheet" href="styles.css">

</head>
<body>

   <form>
     <div style="margin-bottom:10px;">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name">
	</div>
     <div style="margin-bottom:10px;">
	<label for="player">Player:</label>
    <input type="text" id="player" name="player" style="margin-right:15px;">
	</div>
	
   <span>
        <label for="role">Role:</label>
		<select id="role" name="role">
		  <option value="">Select role...</option>
		</select>
		<button type="button" id="copy-url-button" style="margin-left:5px;">Copy URL</button>
		<button type="button" id="clear-button" style="margin-left:10px;">Clear</button>
	</span>
<hr/>
<div id="stats-container"></div>
<hr/>

<p>Moves:</p>

<div id="moves-container"></div>
</form>


<script src="utils.js"></script>
<script src="stats.js"></script>
<script src="moves.js"></script>
<script src="data.js"></script>
<script src="persistence.js"></script>

<script>
  // Get form reference
  const form = document.querySelector('form');
  const roleSelect = document.getElementById('role');
  const movesContainer = 'moves-container';
  const clearButton = document.getElementById('clear-button');
  const copyUrlButton = document.getElementById('copy-url-button');

  // Render stats
  window.renderStats("#stats-container", window.hexStats);

  // Populate role options dynamically
  Object.keys(window.availableMap).forEach(role => {
    const option = document.createElement('option');
    option.value = role;
    option.textContent = role;
    roleSelect.appendChild(option);
  });

  // Render moves according to role
  function updateMoves() {
    const selectedRole = roleSelect.value;
    const available = selectedRole && window.availableMap[selectedRole] ? window.availableMap[selectedRole] : {};

    const container = document.getElementById(movesContainer);
    container.innerHTML = '';

    renderMoves(movesContainer, available, window.moves);
  }

  // Load initial state from URL
  window.Persistence.loadFromURL(form);

  // Initial render of moves (after loading from URL)
  updateMoves();

  // Set up automatic persistence with callback for role changes
  window.Persistence.setupAutoPersistence(form, (inputId, value) => {
    // If role changed, update moves
    if (inputId === 'role') {
      updateMoves();
    }
  });

  // Clear button functionality
  clearButton.addEventListener('click', () => {
    // Use persistence module to clear everything
    window.Persistence.clearState(form);
    
    // Re-render moves (none will show since no role)
    updateMoves();
  });

  // Copy URL button functionality  
  copyUrlButton.addEventListener('click', () => {
    window.Persistence.copyURLToClipboard().then((url) => {
      alert('URL copied to clipboard!');
    }).catch(err => {
      console.error('Failed to copy URL:', err);
      alert('Failed to copy URL to clipboard');
    });
  });

</script>




</body>
</html>
